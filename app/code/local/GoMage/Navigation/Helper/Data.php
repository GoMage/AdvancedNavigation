<?php eval(base64_decode("DQovKioNCiAqIEdvTWFnZSBBZHZhbmNlZCBOYXZpZ2F0aW9uIEV4dGVuc2lvbg0KICoNCiAqIEBjYXRlZ29yeSAgICAgRXh0ZW5zaW9uDQogKiBAY29weXJpZ2h0ICAgIENvcHlyaWdodCAoYykgMjAxMC0yMDE2IEdvTWFnZSAoaHR0cHM6Ly93d3cuZ29tYWdlLmNvbSkNCiAqIEBhdXRob3IgICAgICAgR29NYWdlDQogKiBAbGljZW5zZSAgICAgIGh0dHBzOi8vd3d3LmdvbWFnZS5jb20vbGljZW5zZS1hZ3JlZW1lbnQvICBTaW5nbGUgZG9tYWluIGxpY2Vuc2UNCiAqIEB0ZXJtcyBvZiB1c2UgaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS90ZXJtcy1vZi11c2UNCiAqIEB2ZXJzaW9uICAgICAgUmVsZWFzZTogNC45LjENCiAqIEBzaW5jZSAgICAgICAgQ2xhc3MgYXZhaWxhYmxlIHNpbmNlIFJlbGVhc2UgMS4wDQogKi8NCg0KcmVxdWlyZV9vbmNlKE1hZ2U6OmdldEJhc2VEaXIoJ2xpYicpIC4gRFMgLiAnR29NYWdlJyAuIERTIC4gJ01vYmlsZURldGVjdCcgLiBEUyAuICdOYXZpZ2F0aW9uX01vYmlsZV9EZXRlY3QucGhwJyk7DQoNCmNsYXNzIEdvTWFnZV9OYXZpZ2F0aW9uX0hlbHBlcl9EYXRhIGV4dGVuZHMgTWFnZV9Db3JlX0hlbHBlcl9BYnN0cmFjdA0Kew0KICAgIHByb3RlY3RlZCAkcHJvZHVjdF9hdHRyaWJ1dGVzID0gYXJyYXkoKTsNCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb25maWdEYXRhKCRub2RlKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi8nIC4gJG5vZGUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxTdG9yZURvbWFpbnMoKQ0KICAgIHsNCiAgICAgICAgJGRvbWFpbnMgPSBhcnJheSgpOw0KDQogICAgICAgIGZvcmVhY2ggKE1hZ2U6OmFwcCgpLT5nZXRXZWJzaXRlcygpIGFzICR3ZWJzaXRlKSB7DQogICAgICAgICAgICAkdXJsID0gJHdlYnNpdGUtPmdldENvbmZpZygnd2ViL3Vuc2VjdXJlL2Jhc2VfdXJsJyk7DQogICAgICAgICAgICBpZiAoJGRvbWFpbiA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvXi4qP1xcL1xcLyguKik/XFwvLycsICckMScsICR1cmwpKSkgew0KICAgICAgICAgICAgICAgICRkb21haW5zW10gPSAkZG9tYWluOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkdXJsID0gJHdlYnNpdGUtPmdldENvbmZpZygnd2ViL3NlY3VyZS9iYXNlX3VybCcpOw0KDQogICAgICAgICAgICBpZiAoJGRvbWFpbiA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvXi4qP1xcL1xcLyguKik/XFwvLycsICckMScsICR1cmwpKSkgew0KICAgICAgICAgICAgICAgICRkb21haW5zW10gPSAkZG9tYWluOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhcnJheV91bmlxdWUoJGRvbWFpbnMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBdmFpbGFiZWxXZWJzaXRlcygpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPl93KCk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEF2YWlsYXZlbFdlYnNpdGVzKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+X3coKTsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3coKQ0KICAgIHsNCiAgICAgICAgaWYgKCFNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL2luc3RhbGxlZCcpIHx8DQogICAgICAgICAgICAoaW50dmFsKE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vY291bnQnKSkgPiAxMCkNCiAgICAgICAgKSB7DQogICAgICAgICAgICByZXR1cm4gYXJyYXkoKTsNCiAgICAgICAgfQ0KDQogICAgICAgICR0aW1lX3RvX3VwZGF0ZSA9IDYwICogNjAgKiAyNCAqIDE1Ow0KDQogICAgICAgICRyID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2FkdmFuY2VkbmF2aWdhdGlvbi9hcicpOw0KICAgICAgICAkdCA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vdGltZScpOw0KICAgICAgICAkcyA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vd2Vic2l0ZXMnKTsNCg0KICAgICAgICAkbGFzdF9jaGVjayA9IHN0cl9yZXBsYWNlKCRyLCAnJywgTWFnZTo6aGVscGVyKCdjb3JlJyktPmRlY3J5cHQoJHQpKTsNCg0KICAgICAgICAkYWxsc2l0ZXMgPSBleHBsb2RlKCcsJywgc3RyX3JlcGxhY2UoJHIsICcnLCBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+ZGVjcnlwdCgkcykpKTsNCiAgICAgICAgJGFsbHNpdGVzID0gYXJyYXlfZGlmZigkYWxsc2l0ZXMsIGFycmF5KCIiKSk7DQoNCiAgICAgICAgaWYgKCgkbGFzdF9jaGVjayArICR0aW1lX3RvX3VwZGF0ZSkgPCB0aW1lKCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5hKE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24va2V5JyksDQogICAgICAgICAgICAgICAgaW50dmFsKE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vY291bnQnKSksDQogICAgICAgICAgICAgICAgaW1wbG9kZSgnLCcsICRhbGxzaXRlcykNCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGFsbHNpdGVzOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBhKCRrLCAkYyA9IDAsICRzID0gJycpDQogICAgew0KICAgICAgICAkY2ggPSBjdXJsX2luaXQoKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgc3ByaW50ZignaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS9pbmRleC5waHAvZ29tYWdlX2Rvd25sb2FkYWJsZS9rZXkvY2hlY2snKSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NULCB0cnVlKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsICdrZXk9JyAuIHVybGVuY29kZSgkaykgLiAnJnNrdT1hZHZhbmNlZC1uYXZpZ2F0aW9uJmRvbWFpbnM9JyAuIHVybGVuY29kZShpbXBsb2RlKCcsJywgJHRoaXMtPmdldEFsbFN0b3JlRG9tYWlucygpKSkgLiAnJnZlcj0nIC4gdXJsZW5jb2RlKCc0LjkuMScpKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1RJTUVPVVQsIDMwKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCB0cnVlKTsNCg0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWVBFRVIsIDApOw0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWUhPU1QsIDApOw0KDQogICAgICAgICRjb250ZW50ID0gY3VybF9leGVjKCRjaCk7DQoNCiAgICAgICAgJHIgPSBaZW5kX0pzb246OmRlY29kZSgkY29udGVudCk7DQogICAgICAgICRlID0gTWFnZTo6aGVscGVyKCdjb3JlJyk7DQogICAgICAgIGlmIChlbXB0eSgkcikpIHsNCg0KICAgICAgICAgICAgJHZhbHVlMSA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vYXInKTsNCg0KICAgICAgICAgICAgJGdyb3VwcyA9IGFycmF5KA0KICAgICAgICAgICAgICAgICdhZHZhbmNlZG5hdmlnYXRpb24nID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnZmllbGRzJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICdhcicgICAgICAgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkdmFsdWUxDQogICAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3dlYnNpdGVzJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2FkdmFuY2VkbmF2aWdhdGlvbi93ZWJzaXRlcycpDQogICAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWUnICAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpJGUtPmVuY3J5cHQoJHZhbHVlMSAuICh0aW1lKCkgLSAoNjAgKiA2MCAqIDI0ICogMTUgLSAxODAwKSkgLiAkdmFsdWUxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCcgICAgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkYyArIDEpDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICApOw0KDQogICAgICAgICAgICBNYWdlOjpnZXRNb2RlbCgnYWRtaW5odG1sL2NvbmZpZ19kYXRhJykNCiAgICAgICAgICAgICAgICAtPnNldFNlY3Rpb24oJ2dvbWFnZV9hY3RpdmF0aW9uJykNCiAgICAgICAgICAgICAgICAtPnNldEdyb3VwcygkZ3JvdXBzKQ0KICAgICAgICAgICAgICAgIC0+c2F2ZSgpOw0KDQogICAgICAgICAgICBNYWdlOjpnZXRDb25maWcoKS0+cmVpbml0KCk7DQogICAgICAgICAgICBNYWdlOjphcHAoKS0+cmVpbml0U3RvcmVzKCk7DQoNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgICR2YWx1ZTEgPSAnJzsNCiAgICAgICAgJHZhbHVlMiA9ICcnOw0KDQogICAgICAgIGlmIChpc3NldCgkclsnZCddKSAmJiBpc3NldCgkclsnYyddKSkgew0KICAgICAgICAgICAgJHZhbHVlMSA9ICRlLT5lbmNyeXB0KGJhc2U2NF9lbmNvZGUoWmVuZF9Kc29uOjplbmNvZGUoJHIpKSk7DQoNCiAgICAgICAgICAgIGlmICghJHMpIHsNCiAgICAgICAgICAgICAgICAkcyA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vd2Vic2l0ZXMnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHMgICAgICA9IGFycmF5X3NsaWNlKGV4cGxvZGUoJywnLCAkcyksIDAsICRyWydjJ10pOw0KICAgICAgICAgICAgJHZhbHVlMiA9ICRlLT5lbmNyeXB0KCR2YWx1ZTEgLiBpbXBsb2RlKCcsJywgJHMpIC4gJHZhbHVlMSk7DQogICAgICAgIH0NCiAgICAgICAgJGdyb3VwcyA9IGFycmF5KA0KICAgICAgICAgICAgJ2FkdmFuY2VkbmF2aWdhdGlvbicgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgJ2ZpZWxkcycgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICdhcicgICAgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkdmFsdWUxDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICd3ZWJzaXRlcycgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKSR2YWx1ZTINCiAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgJ3RpbWUnICAgICAgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpJGUtPmVuY3J5cHQoJHZhbHVlMSAuIHRpbWUoKSAuICR2YWx1ZTEpDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAxDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICdjb3VudCcgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAwKQ0KDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgKQ0KICAgICAgICApOw0KDQogICAgICAgIE1hZ2U6OmdldE1vZGVsKCdhZG1pbmh0bWwvY29uZmlnX2RhdGEnKQ0KICAgICAgICAgICAgLT5zZXRTZWN0aW9uKCdnb21hZ2VfYWN0aXZhdGlvbicpDQogICAgICAgICAgICAtPnNldEdyb3VwcygkZ3JvdXBzKQ0KICAgICAgICAgICAgLT5zYXZlKCk7DQoNCiAgICAgICAgTWFnZTo6Z2V0Q29uZmlnKCktPnJlaW5pdCgpOw0KICAgICAgICBNYWdlOjphcHAoKS0+cmVpbml0U3RvcmVzKCk7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAcmV0dXJuIGFycmF5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdhKCkNCiAgICB7DQogICAgICAgICRnYVJlc3VsdCA9IFtdOw0KICAgICAgICAkZGVjcnlwdGVkID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmRlY3J5cHQoTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2FkdmFuY2VkbmF2aWdhdGlvbi9hcicpKTsNCiAgICAgICAgJGRlY29kZWRCYXNlNjQgPSBiYXNlNjRfZGVjb2RlKCRkZWNyeXB0ZWQpOw0KDQogICAgICAgIGlmICgkZGVjb2RlZEJhc2U2NCkgew0KICAgICAgICAgICAgJGdhUmVzdWx0ID0gWmVuZF9Kc29uOjpkZWNvZGUoJGRlY29kZWRCYXNlNjQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRnYVJlc3VsdDsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNHb21hZ2VOYXZpZ2F0aW9uKCkNCiAgICB7DQogICAgICAgIGlmICgkdGhpcy0+aXNNb2JpbGVEZXZpY2UoKSAmJiBNYWdlOjpnZXRTdG9yZUNvbmZpZ0ZsYWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2dlbmVyYWwvZGlzYWJsZV9tb2JpbGUnKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpbl9hcnJheShNYWdlOjphcHAoKS0+Z2V0U3RvcmUoKS0+Z2V0V2Vic2l0ZUlkKCksICR0aGlzLT5nZXRBdmFpbGF2ZWxXZWJzaXRlcygpKSAmJg0KICAgICAgICBNYWdlOjpnZXRTdG9yZUNvbmZpZ0ZsYWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2dlbmVyYWwvbW9kZScpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0dvbWFnZU5hdmlnYXRpb25NZW51KCkNCiAgICB7DQogICAgICAgIHJldHVybiBpbl9hcnJheShNYWdlOjphcHAoKS0+Z2V0U3RvcmUoKS0+Z2V0V2Vic2l0ZUlkKCksICR0aGlzLT5nZXRBdmFpbGF2ZWxXZWJzaXRlcygpKSAmJg0KICAgICAgICBNYWdlOjpnZXRTdG9yZUNvbmZpZ0ZsYWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL21lbnViYXJzZXR0aW5ncy9uYXZpZ2F0aW9uJyk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzR29tYWdlTmF2aWdhdGlvbkFqYXgoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5pc0dvbWFnZU5hdmlnYXRpb24oKSAmJg0KICAgICAgICBNYWdlOjpnZXRTdG9yZUNvbmZpZ0ZsYWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2dlbmVyYWwvcGFnZXInKSAmJg0KICAgICAgICAoTWFnZTo6cmVnaXN0cnkoJ2N1cnJlbnRfY2F0ZWdvcnknKSB8fA0KICAgICAgICAgICAgKE1hZ2U6OmFwcCgpLT5nZXRGcm9udENvbnRyb2xsZXIoKS0+Z2V0UmVxdWVzdCgpLT5nZXRSb3V0ZU5hbWUoKSA9PSAnY2F0YWxvZ3NlYXJjaCcgJiYNCiAgICAgICAgICAgICAgICBNYWdlOjphcHAoKS0+Z2V0RnJvbnRDb250cm9sbGVyKCktPmdldFJlcXVlc3QoKS0+Z2V0Q29udHJvbGxlck5hbWUoKSAhPSAnYWR2YW5jZWQnKSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzR29tYWdlTmF2aWdhdGlvbkNsZWFyQWpheCgpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmlzR29tYWdlTmF2aWdhdGlvbigpICYmDQogICAgICAgIChNYWdlOjpyZWdpc3RyeSgnY3VycmVudF9jYXRlZ29yeScpIHx8DQogICAgICAgICAgICAoTWFnZTo6YXBwKCktPmdldEZyb250Q29udHJvbGxlcigpLT5nZXRSZXF1ZXN0KCktPmdldFJvdXRlTmFtZSgpID09ICdjYXRhbG9nc2VhcmNoJyAmJg0KICAgICAgICAgICAgICAgIE1hZ2U6OmFwcCgpLT5nZXRGcm9udENvbnRyb2xsZXIoKS0+Z2V0UmVxdWVzdCgpLT5nZXRDb250cm9sbGVyTmFtZSgpICE9ICdhZHZhbmNlZCcpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZm9ybWF0Q29sb3IoJHZhbHVlKQ0KICAgIHsNCiAgICAgICAgaWYgKCR2YWx1ZSA9IHByZWdfcmVwbGFjZSgnL1teYS16QS1aMC05XHNdLycsICcnLCAkdmFsdWUpKSB7DQogICAgICAgICAgICAkdmFsdWUgPSAnIycgLiAkdmFsdWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR2YWx1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNGcmVuZGx5VXJsKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+aXNHb21hZ2VOYXZpZ2F0aW9uKCkgJiYNCiAgICAgICAgTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXJfc2V0dGluZ3MvZnJlbmRseXVybCcpICYmDQogICAgICAgICEkdGhpcy0+aXNHb01hZ2VTZW9Cb29zdGVyRW5hYmxlZCgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0dvTWFnZVNlb0Jvb3N0ZXJFbmFibGVkKCkNCiAgICB7DQogICAgICAgICRfbW9kdWxlcyAgICAgID0gTWFnZTo6Z2V0Q29uZmlnKCktPmdldE5vZGUoJ21vZHVsZXMnKS0+Y2hpbGRyZW4oKTsNCiAgICAgICAgJF9tb2R1bGVzQXJyYXkgPSAoYXJyYXkpJF9tb2R1bGVzOw0KICAgICAgICBpZiAoIWlzc2V0KCRfbW9kdWxlc0FycmF5WydHb01hZ2VfU2VvQm9vc3RlciddKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkX21vZHVsZXNBcnJheVsnR29NYWdlX1Nlb0Jvb3N0ZXInXS0+aXMoJ2FjdGl2ZScpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXF1ZXN0KCkNCiAgICB7DQogICAgICAgICRyZXF1ZXN0ID0gTWFnZTo6YXBwKCktPmdldEZyb250Q29udHJvbGxlcigpLT5nZXRSZXF1ZXN0KCk7DQogICAgICAgIGlmICgkdGhpcy0+aXNHb01hZ2VTZW9Cb29zdGVyRW5hYmxlZCgpKSB7DQogICAgICAgICAgICAkaGVscGVyICA9IE1hZ2U6OmhlbHBlcignZ29tYWdlX3Nlb2Jvb3N0ZXIvbGF5ZXJlZCcpOw0KICAgICAgICAgICAgJHJlcXVlc3QgPSAkaGVscGVyLT5nZXRTZXBhcmF0b3IoKSB8fCAkaGVscGVyLT5jYW5BZGRSZXdyaXRlUGF0aCgpID8gJGhlbHBlci0+Z2V0UmVxdWVzdCgpIDogJHJlcXVlc3Q7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJHJlcXVlc3Q7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEZpbHRlclVybCgkcm91dGUgPSAnKi8qLyonLCAkcGFyYW1zID0gYXJyYXkoKSkNCiAgICB7DQogICAgICAgIGlmICghJHRoaXMtPmlzRnJlbmRseVVybCgpKSB7DQogICAgICAgICAgICAkcGFyYW1zWydfcXVlcnknXVsnYWpheCddID0gbnVsbDsNCiAgICAgICAgICAgIA0KCQkJcmV0dXJuIE1hZ2U6OmhlbHBlcignZ29tYWdlX25hdmlnYXRpb24vdXJsJyktPndyYXBwKE1hZ2U6OmdldFVybCgkcm91dGUsICRwYXJhbXMpKTsNCiAgICAgICAgfQ0KDQogICAgICAgICRtb2RlbCA9IE1hZ2U6OmdldE1vZGVsKCdjb3JlL3VybCcpOw0KICAgICAgICAkYXR0ciAgPSBNYWdlOjpyZWdpc3RyeSgnZ2FuX2ZpbHRlcl9hdHRyaWJ1dGVzJyk7DQoNCiAgICAgICAgJHF1ZXJ5X3BhcmFtcyA9IGlzX2FycmF5KCRtb2RlbC0+Z2V0UmVxdWVzdCgpLT5nZXRRdWVyeSgpKSA/ICRtb2RlbC0+Z2V0UmVxdWVzdCgpLT5nZXRRdWVyeSgpIDogYXJyYXkoKTsNCiAgICAgICAgJHF1ZXJ5ICAgICAgICA9IGFycmF5KCk7DQoNCiAgICAgICAgaWYgKGlzc2V0KCRwYXJhbXNbJ19xdWVyeSddKSAmJiBpc19hcnJheSgkcGFyYW1zWydfcXVlcnknXSkpIHsNCiAgICAgICAgICAgICRxdWVyeV9wYXJhbXMgPSBhcnJheV9tZXJnZSgkcXVlcnlfcGFyYW1zLCAkcGFyYW1zWydfcXVlcnknXSk7DQogICAgICAgIH0NCgkJDQogICAgICAgIGZvcmVhY2ggKCRxdWVyeV9wYXJhbXMgYXMgJHBhcmFtID0+ICR2YWx1ZSkgew0KDQogICAgICAgICAgICBpZiAoaXNfbnVsbCgkdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbV0gPSBudWxsOw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJHBhcmFtID09ICdjYXQnKSB7DQogICAgICAgICAgICAgICAgJHZhbHVlcyAgICAgICAgID0gZXhwbG9kZSgnLCcsICR2YWx1ZSk7DQogICAgICAgICAgICAgICAgJHByZXBhcmVfdmFsdWVzID0gYXJyYXkoKTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdmFsdWVzIGFzICRfdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgJGNhdGVnb3J5ID0gTWFnZTo6Z2V0TW9kZWwoJ2NhdGFsb2cvY2F0ZWdvcnknKS0+bG9hZCgkX3ZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjYXRlZ29yeSAmJiAkY2F0ZWdvcnktPmdldElkKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYWdlOjpnZXRTdG9yZUNvbmZpZ0ZsYWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2ZpbHRlcl9zZXR0aW5ncy9leHBlbmRfZnJlbmRseXVybCcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcmVudF9pZHMgICAgICAgPSAkY2F0ZWdvcnktPmdldFBhcmVudElkcygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXJlbnRfY2F0ZWdvcnkgID0gTWFnZTo6Z2V0TW9kZWwoJ2NhdGFsb2cvY2F0ZWdvcnknKS0+bG9hZChlbmQoJHBhcmVudF9pZHMpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJlcGFyZV92YWx1ZXNbXSA9ICRwYXJlbnRfY2F0ZWdvcnktPmdldERhdGEoJ3VybF9rZXknKSAuICd8JyAuICRjYXRlZ29yeS0+Z2V0RGF0YSgndXJsX2tleScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJlcGFyZV92YWx1ZXNbXSA9ICRjYXRlZ29yeS0+Z2V0RGF0YSgndXJsX2tleScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHByZXBhcmVfdmFsdWVzKSkgew0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtXSA9IGltcGxvZGUoJywnLCAkcHJlcGFyZV92YWx1ZXMpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJGF0dHJbJHBhcmFtXSkgJiYgIWluX2FycmF5KCRhdHRyWyRwYXJhbV1bJ3R5cGUnXSwgYXJyYXkoJ3ByaWNlJywgJ2RlY2ltYWwnKSkpIHsNCiAgICAgICAgICAgICAgICAkdmFsdWVzICAgICAgICAgPSBleHBsb2RlKCcsJywgJHZhbHVlKTsNCiAgICAgICAgICAgICAgICAkcHJlcGFyZV92YWx1ZXMgPSBhcnJheSgpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR2YWx1ZXMgYXMgJF92YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkYXR0clskcGFyYW1dWydvcHRpb25zJ10gYXMgJF9rID0+ICRfdikgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfdiA9PSAkX3ZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXBhcmVfdmFsdWVzW10gPSAkX2s7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcHJlcGFyZV92YWx1ZXMpKSB7DQogICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gaW1wbG9kZSgnLCcsICRwcmVwYXJlX3ZhbHVlcyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbV0gPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZWlmIChpc3NldCgkYXR0clskcGFyYW1dKSAmJiBpbl9hcnJheSgkYXR0clskcGFyYW1dWyd0eXBlJ10sIGFycmF5KCdwcmljZScsICdkZWNpbWFsJykpKSB7DQogICAgICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZVsnZnJvbSddKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbSAuICdfZnJvbSddID0gJHZhbHVlWydmcm9tJ107DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZVsndG8nXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW0gLiAnX3RvJ10gPSAkdmFsdWVbJ3RvJ107DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoKCRhdHRyaWJ1dGUgPSAkdGhpcy0+Z2V0UHJvZHVjdEF0dHJpYnV0ZSgkcGFyYW0pKSAmJg0KICAgICAgICAgICAgICAgICAgICBpbl9hcnJheSgkYXR0cmlidXRlLT5nZXRSYW5nZU9wdGlvbnMoKSwgYXJyYXkoR29NYWdlX05hdmlnYXRpb25fTW9kZWxfQWRtaW5odG1sX1N5c3RlbV9Db25maWdfU291cmNlX0ZpbHRlcl9PcHRpb25zcmFuZ2U6Ok1BTlVBTExZLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdvTWFnZV9OYXZpZ2F0aW9uX01vZGVsX0FkbWluaHRtbF9TeXN0ZW1fQ29uZmlnX1NvdXJjZV9GaWx0ZXJfT3B0aW9uc3JhbmdlOjpBVVRPKQ0KICAgICAgICAgICAgICAgICAgICApICYmDQogICAgICAgICAgICAgICAgICAgICRhdHRyaWJ1dGUtPmdldEZpbHRlclR5cGUoKSA9PSBHb01hZ2VfTmF2aWdhdGlvbl9Nb2RlbF9DYXRhbG9nX0xheWVyOjpGSUxURVJfVFlQRV9ERUZBVUxUDQogICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICR2YWx1ZXMgICAgICAgICAgICAgICAgICA9IGV4cGxvZGUoJywnLCAkdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtIC4gJ19mcm9tJ10gPSAkdmFsdWVzWzBdOw0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtIC4gJ190byddICAgPSAkdmFsdWVzWzFdOw0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtXSAgICAgICAgICAgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gJHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbV0gPSAkdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAkcGFyYW1zWydfcXVlcnknXSAgICAgICAgID0gJHF1ZXJ5Ow0KICAgICAgICAkcGFyYW1zWydfcXVlcnknXVsnYWpheCddID0gbnVsbDsNCiAgICAgICAgJHBhcmFtc1snX3NlY3VyZSddID0gIE1hZ2U6OmFwcCgpLT5nZXRGcm9udENvbnRyb2xsZXIoKS0+Z2V0UmVxdWVzdCgpLT5pc1NlY3VyZSgpOw0KDQogICAgICAgIHJldHVybiBNYWdlOjpoZWxwZXIoJ2dvbWFnZV9uYXZpZ2F0aW9uL3VybCcpLT53cmFwcCgkbW9kZWwtPmdldFVybCgkcm91dGUsICRwYXJhbXMpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZm9ybWF0VXJsVmFsdWUoJHZhbHVlLCAkZGVmYXVsdCkNCiAgICB7DQogICAgICAgICRvbGRMb2NhbGUgID0gc2V0bG9jYWxlKExDX0NPTExBVEUsICIwIik7DQogICAgICAgICRsb2NhbGVDb2RlID0gTWFnZTo6YXBwKCktPmdldExvY2FsZSgpLT5nZXRMb2NhbGVDb2RlKCk7DQogICAgICAgIHNldGxvY2FsZShMQ19DT0xMQVRFLCAkbG9jYWxlQ29kZSAuICcuVVRGOCcsICdDLlVURi04JywgJ2VuX1VTLnV0ZjgnKTsNCiAgICAgICAgJHZhbHVlID0gaWNvbnYobWJfZGV0ZWN0X2VuY29kaW5nKCR2YWx1ZSksICdBU0NJSS8vVFJBTlNMSVQnLCAkdmFsdWUpOw0KICAgICAgICBzZXRsb2NhbGUoTENfQ09MTEFURSwgJG9sZExvY2FsZSk7DQoNCiAgICAgICAgJHZhbHVlID0gc3RydG9sb3dlcigkdmFsdWUpOw0KICAgICAgICAkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJyNbXjAtOWEtel0rI2knLCAnLScsIE1hZ2U6OmhlbHBlcignY2F0YWxvZy9wcm9kdWN0X3VybCcpLT5mb3JtYXQoJHZhbHVlKSk7DQogICAgICAgICR2YWx1ZSA9IHRyaW0oJHZhbHVlLCAnLScpOw0KDQogICAgICAgIHJldHVybiAkdmFsdWUgPyAkdmFsdWUgOiAkZGVmYXVsdDsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNNb2JpbGVEZXZpY2UoKQ0KICAgIHsNCiAgICAgICAgJGRldGVjdCA9IG5ldyBOYXZpZ2F0aW9uX01vYmlsZV9EZXRlY3QoKTsNCiAgICAgICAgcmV0dXJuICRkZXRlY3QtPmlzTW9iaWxlKCk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEZpbHRlckl0ZW1Db3VudCgkZmlsdGVyKQ0KICAgIHsNCiAgICAgICAgJGNvdW50ID0gMDsNCiAgICAgICAgaWYgKCRmaWx0ZXIgJiYgJGZpbHRlci0+Z2V0SXRlbXMoKSkgew0KICAgICAgICAgICAgZm9yZWFjaCAoJGZpbHRlci0+Z2V0SXRlbXMoKSBhcyAkaXRlbSkgew0KICAgICAgICAgICAgICAgICRjb3VudCArPSAkaXRlbS0+Z2V0Q291bnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KCQkNCiAgICAgICAgaWYgKCRjb3VudCA9PSAwICYmICRmaWx0ZXItPmdldEZpbHRlcigpLT5nZXRSZXF1ZXN0VmFyVmFsdWUoKSA9PSAnc3RvY2tfc3RhdHVzJykgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGNvdW50Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRGaWx0ZXIoKQ0KICAgIHsNCiAgICAgICAgJGZpbHRlciA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXIvZmlsdGVyX2J0bl90eHQnKTsNCg0KICAgICAgICBpZiAoJGZpbHRlciA9PSAnJykgew0KICAgICAgICAgICAgJGZpbHRlciA9ICR0aGlzLT5fXygnRmlsdGVyJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGZpbHRlcjsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2xlYXJBbGwoKQ0KICAgIHsNCiAgICAgICAgJGNsZWFyID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2ZpbHRlci9jbGVhcl9idG5fdHh0Jyk7DQoNCiAgICAgICAgaWYgKCRjbGVhciA9PSAnJykgew0KICAgICAgICAgICAgJGNsZWFyID0gJHRoaXMtPl9fKCdDbGVhciBBbGwnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkY2xlYXI7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldE1vcmUoKQ0KICAgIHsNCiAgICAgICAgJG1vcmUgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZmlsdGVyL21vcmVfYnRuX3R4dCcpOw0KDQogICAgICAgIGlmICgkbW9yZSA9PSAnJykgew0KICAgICAgICAgICAgJG1vcmUgPSAkdGhpcy0+X18oJ01vcmUnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkbW9yZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TGVzcygpDQogICAgew0KICAgICAgICAkbGVzcyA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXIvbGVzc19idG5fdHh0Jyk7DQoNCiAgICAgICAgaWYgKCRsZXNzID09ICcnKSB7DQogICAgICAgICAgICAkbGVzcyA9ICR0aGlzLT5fXygnTGVzcycpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRsZXNzOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTaG93bW9yZSgpDQogICAgew0KICAgICAgICAkc2hvd21vcmUgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZmlsdGVyL3Nob3dtb3JlX2J0bl90eHQnKTsNCg0KICAgICAgICBpZiAoJHNob3dtb3JlID09ICcnKSB7DQogICAgICAgICAgICAkc2hvd21vcmUgPSAkdGhpcy0+X18oJ1Nob3cgbW9yZSBwcm9kdWN0cycpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRzaG93bW9yZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QmFja3RvdG9wKCkNCiAgICB7DQogICAgICAgICRiYWNrdG90b3AgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZmlsdGVyL2JhY2t0b3RvcF9idG5fdHh0Jyk7DQoNCiAgICAgICAgaWYgKCRiYWNrdG90b3AgPT0gJycpIHsNCiAgICAgICAgICAgICRiYWNrdG90b3AgPSAkdGhpcy0+X18oJ0JhY2sgdG8gVG9wJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGJhY2t0b3RvcDsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFbnRlcnByaXNlKCkNCiAgICB7DQogICAgICAgIGlmIChNYWdlOjpnZXRDb25maWcoKS0+Z2V0TW9kdWxlQ29uZmlnKCdFbnRlcnByaXNlX0VudGVycHJpc2UnKSAmJiBNYWdlOjpnZXRDb25maWcoKS0+Z2V0TW9kdWxlQ29uZmlnKCdFbnRlcnByaXNlX0FkbWluR3dzJykgJiYgTWFnZTo6Z2V0Q29uZmlnKCktPmdldE1vZHVsZUNvbmZpZygnRW50ZXJwcmlzZV9DaGVja291dCcpICYmIE1hZ2U6OmdldENvbmZpZygpLT5nZXRNb2R1bGVDb25maWcoJ0VudGVycHJpc2VfQ3VzdG9tZXInKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNpZGUoJHR5cGUpDQogICAgew0KICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7DQogICAgICAgICAgICBjYXNlIEdvTWFnZV9OYXZpZ2F0aW9uX01vZGVsX0FkbWluaHRtbF9TeXN0ZW1fQ29uZmlnX1NvdXJjZV9GaWx0ZXJfQXR0cmlidXRlbG9jYXRpb246OkxFRlRfQkxPQ0s6DQogICAgICAgICAgICAgICAgcmV0dXJuICdsZWZ0JzsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBHb01hZ2VfTmF2aWdhdGlvbl9Nb2RlbF9BZG1pbmh0bWxfU3lzdGVtX0NvbmZpZ19Tb3VyY2VfRmlsdGVyX0F0dHJpYnV0ZWxvY2F0aW9uOjpDT05URU5UOg0KICAgICAgICAgICAgICAgIHJldHVybiAnY29udGVudCc7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgR29NYWdlX05hdmlnYXRpb25fTW9kZWxfQWRtaW5odG1sX1N5c3RlbV9Db25maWdfU291cmNlX0ZpbHRlcl9BdHRyaWJ1dGVsb2NhdGlvbjo6UklHSFRfQkxPQ0s6DQogICAgICAgICAgICAgICAgcmV0dXJuICdyaWdodCc7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmV0dXJuICdsZWZ0JzsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBub3RpZnkoKQ0KICAgIHsNCiAgICAgICAgJGZyZXF1ZW5jeSA9IGludHZhbChNYWdlOjphcHAoKS0+bG9hZENhY2hlKCdnb21hZ2Vfbm90aWZpY2F0aW9uc19mcmVxdWVuY3knKSk7DQogICAgICAgIGlmICghJGZyZXF1ZW5jeSkgew0KICAgICAgICAgICAgJGZyZXF1ZW5jeSA9IDI0Ow0KICAgICAgICB9DQogICAgICAgICRsYXN0X3VwZGF0ZSA9IGludHZhbChNYWdlOjphcHAoKS0+bG9hZENhY2hlKCdnb21hZ2Vfbm90aWZpY2F0aW9uc19sYXN0X3VwZGF0ZScpKTsNCg0KICAgICAgICBpZiAoKCRmcmVxdWVuY3kgKiA2MCAqIDYwICsgJGxhc3RfdXBkYXRlKSA+IHRpbWUoKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgJHRpbWVzdGFtcCA9ICRsYXN0X3VwZGF0ZTsNCiAgICAgICAgaWYgKCEkdGltZXN0YW1wKSB7DQogICAgICAgICAgICAkdGltZXN0YW1wID0gdGltZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgc3ByaW50ZignaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS9pbmRleC5waHAvZ29tYWdlX25vdGlmaWNhdGlvbi9pbmRleC9kYXRhJykpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1QsIHRydWUpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsICdza3U9YWR2YW5jZWQtbmF2aWdhdGlvbiZ0aW1lc3RhbXA9JyAuICR0aW1lc3RhbXAgLiAnJnZlcj0nIC4gdXJsZW5jb2RlKCc0LjkuMScpKTsNCiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOw0KDQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWVBFRVIsIDApOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllIT1NULCAwKTsNCg0KICAgICAgICAgICAgJGNvbnRlbnQgPSBjdXJsX2V4ZWMoJGNoKTsNCg0KICAgICAgICAgICAgJHJlc3VsdCA9IFplbmRfSnNvbjo6ZGVjb2RlKCRjb250ZW50KTsNCg0KICAgICAgICAgICAgaWYgKCRyZXN1bHQgJiYgaXNzZXQoJHJlc3VsdFsnZnJlcXVlbmN5J10pICYmICgkcmVzdWx0WydmcmVxdWVuY3knXSAhPSAkZnJlcXVlbmN5KSkgew0KICAgICAgICAgICAgICAgIE1hZ2U6OmFwcCgpLT5zYXZlQ2FjaGUoJHJlc3VsdFsnZnJlcXVlbmN5J10sICdnb21hZ2Vfbm90aWZpY2F0aW9uc19mcmVxdWVuY3knKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCRyZXN1bHQgJiYgaXNzZXQoJHJlc3VsdFsnZGF0YSddKSkgew0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlc3VsdFsnZGF0YSddKSkgew0KICAgICAgICAgICAgICAgICAgICBNYWdlOjpnZXRNb2RlbCgnYWRtaW5ub3RpZmljYXRpb24vaW5ib3gnKS0+cGFyc2UoJHJlc3VsdFsnZGF0YSddKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICB9DQoNCiAgICAgICAgTWFnZTo6YXBwKCktPnNhdmVDYWNoZSh0aW1lKCksICdnb21hZ2Vfbm90aWZpY2F0aW9uc19sYXN0X3VwZGF0ZScpOw0KDQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldElzQW55bW9yZVZlcnNpb24oJG1ham9yLCAkbWlub3IsICRyZXZpc2lvbiA9IDApDQogICAgew0KICAgICAgICAkdmVyc2lvbl9pbmZvID0gTWFnZTo6Z2V0VmVyc2lvbigpOw0KICAgICAgICAkdmVyc2lvbl9pbmZvID0gZXhwbG9kZSgnLicsICR2ZXJzaW9uX2luZm8pOw0KDQogICAgICAgIGlmICgkdmVyc2lvbl9pbmZvWzBdID4gJG1ham9yKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlaWYgKCR2ZXJzaW9uX2luZm9bMF0gPT0gJG1ham9yKSB7DQogICAgICAgICAgICBpZiAoJHZlcnNpb25faW5mb1sxXSA+ICRtaW5vcikgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfSBlbHNlaWYgKCR2ZXJzaW9uX2luZm9bMV0gPT0gJG1pbm9yKSB7DQogICAgICAgICAgICAgICAgaWYgKCR2ZXJzaW9uX2luZm9bMl0gPj0gJHJldmlzaW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQcm9kdWN0QXR0cmlidXRlKCRjb2RlKQ0KICAgIHsNCiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+cHJvZHVjdF9hdHRyaWJ1dGVzWyRjb2RlXSkpIHsNCiAgICAgICAgICAgICRhdHRyaWJ1dGVNb2RlbCAgICAgICAgICAgICAgICAgID0gTWFnZTo6Z2V0TW9kZWwoJ2Vhdi9lbnRpdHlfYXR0cmlidXRlJyktPmxvYWRCeUNvZGUoJ2NhdGFsb2dfcHJvZHVjdCcsICRjb2RlKTsNCiAgICAgICAgICAgICRhdHRyaWJ1dGUgICAgICAgICAgICAgICAgICAgICAgID0gTWFnZTo6Z2V0TW9kZWwoJ2NhdGFsb2cvcmVzb3VyY2VfZWF2X2F0dHJpYnV0ZScpLT5sb2FkKCRhdHRyaWJ1dGVNb2RlbC0+Z2V0SWQoKSk7DQogICAgICAgICAgICAkdGhpcy0+cHJvZHVjdF9hdHRyaWJ1dGVzWyRjb2RlXSA9ICRhdHRyaWJ1dGU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5wcm9kdWN0X2F0dHJpYnV0ZXNbJGNvZGVdOw0KICAgIH0NCg0KfQ0KDQo="));
