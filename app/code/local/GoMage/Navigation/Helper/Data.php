<?php eval(base64_decode("LyoqDQogKiBHb01hZ2UgQWR2YW5jZWQgTmF2aWdhdGlvbiBFeHRlbnNpb24NCiAqDQogKiBAY2F0ZWdvcnkgICAgIEV4dGVuc2lvbg0KICogQGNvcHlyaWdodCAgICBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxNiBHb01hZ2UgKGh0dHBzOi8vd3d3LmdvbWFnZS5jb20pDQogKiBAYXV0aG9yICAgICAgIEdvTWFnZQ0KICogQGxpY2Vuc2UgICAgICBodHRwczovL3d3dy5nb21hZ2UuY29tL2xpY2Vuc2UtYWdyZWVtZW50LyAgU2luZ2xlIGRvbWFpbiBsaWNlbnNlDQogKiBAdGVybXMgb2YgdXNlIGh0dHBzOi8vd3d3LmdvbWFnZS5jb20vdGVybXMtb2YtdXNlDQogKiBAdmVyc2lvbiAgICAgIFJlbGVhc2U6IDQuOS4xDQogKiBAc2luY2UgICAgICAgIENsYXNzIGF2YWlsYWJsZSBzaW5jZSBSZWxlYXNlIDEuMA0KICovDQoNCnJlcXVpcmVfb25jZShNYWdlOjpnZXRCYXNlRGlyKCdsaWInKSAuIERTIC4gJ0dvTWFnZScgLiBEUyAuICdNb2JpbGVEZXRlY3QnIC4gRFMgLiAnTmF2aWdhdGlvbl9Nb2JpbGVfRGV0ZWN0LnBocCcpOw0KDQpjbGFzcyBHb01hZ2VfTmF2aWdhdGlvbl9IZWxwZXJfRGF0YSBleHRlbmRzIE1hZ2VfQ29yZV9IZWxwZXJfQWJzdHJhY3QNCnsNCiAgICBwcm90ZWN0ZWQgJHByb2R1Y3RfYXR0cmlidXRlcyA9IGFycmF5KCk7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q29uZmlnRGF0YSgkbm9kZSkNCiAgICB7DQogICAgICAgIHJldHVybiBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vJyAuICRub2RlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsU3RvcmVEb21haW5zKCkNCiAgICB7DQogICAgICAgICRkb21haW5zID0gYXJyYXkoKTsNCg0KICAgICAgICBmb3JlYWNoIChNYWdlOjphcHAoKS0+Z2V0V2Vic2l0ZXMoKSBhcyAkd2Vic2l0ZSkgew0KICAgICAgICAgICAgJHVybCA9ICR3ZWJzaXRlLT5nZXRDb25maWcoJ3dlYi91bnNlY3VyZS9iYXNlX3VybCcpOw0KICAgICAgICAgICAgaWYgKCRkb21haW4gPSB0cmltKHByZWdfcmVwbGFjZSgnL14uKj9cXC9cXC8oLiopP1xcLy8nLCAnJDEnLCAkdXJsKSkpIHsNCiAgICAgICAgICAgICAgICAkZG9tYWluc1tdID0gJGRvbWFpbjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHVybCA9ICR3ZWJzaXRlLT5nZXRDb25maWcoJ3dlYi9zZWN1cmUvYmFzZV91cmwnKTsNCg0KICAgICAgICAgICAgaWYgKCRkb21haW4gPSB0cmltKHByZWdfcmVwbGFjZSgnL14uKj9cXC9cXC8oLiopP1xcLy8nLCAnJDEnLCAkdXJsKSkpIHsNCiAgICAgICAgICAgICAgICAkZG9tYWluc1tdID0gJGRvbWFpbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYXJyYXlfdW5pcXVlKCRkb21haW5zKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXZhaWxhYmVsV2Vic2l0ZXMoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5fdygpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBdmFpbGF2ZWxXZWJzaXRlcygpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPl93KCk7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF93KCkNCiAgICB7DQogICAgICAgIGlmICghTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2FkdmFuY2VkbmF2aWdhdGlvbi9pbnN0YWxsZWQnKSB8fA0KICAgICAgICAgICAgKGludHZhbChNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL2NvdW50JykpID4gMTApDQogICAgICAgICkgew0KICAgICAgICAgICAgcmV0dXJuIGFycmF5KCk7DQogICAgICAgIH0NCg0KICAgICAgICAkdGltZV90b191cGRhdGUgPSA2MCAqIDYwICogMjQgKiAxNTsNCg0KICAgICAgICAkciA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vYXInKTsNCiAgICAgICAgJHQgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL3RpbWUnKTsNCiAgICAgICAgJHMgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL3dlYnNpdGVzJyk7DQoNCiAgICAgICAgJGxhc3RfY2hlY2sgPSBzdHJfcmVwbGFjZSgkciwgJycsIE1hZ2U6OmhlbHBlcignY29yZScpLT5kZWNyeXB0KCR0KSk7DQoNCiAgICAgICAgJGFsbHNpdGVzID0gZXhwbG9kZSgnLCcsIHN0cl9yZXBsYWNlKCRyLCAnJywgTWFnZTo6aGVscGVyKCdjb3JlJyktPmRlY3J5cHQoJHMpKSk7DQogICAgICAgICRhbGxzaXRlcyA9IGFycmF5X2RpZmYoJGFsbHNpdGVzLCBhcnJheSgiIikpOw0KDQogICAgICAgIGlmICgoJGxhc3RfY2hlY2sgKyAkdGltZV90b191cGRhdGUpIDwgdGltZSgpKSB7DQogICAgICAgICAgICAkdGhpcy0+YShNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL2tleScpLA0KICAgICAgICAgICAgICAgIGludHZhbChNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL2NvdW50JykpLA0KICAgICAgICAgICAgICAgIGltcGxvZGUoJywnLCAkYWxsc2l0ZXMpDQogICAgICAgICAgICApOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRhbGxzaXRlczsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gYSgkaywgJGMgPSAwLCAkcyA9ICcnKQ0KICAgIHsNCiAgICAgICAgJGNoID0gY3VybF9pbml0KCk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsIHNwcmludGYoJ2h0dHBzOi8vd3d3LmdvbWFnZS5jb20vaW5kZXgucGhwL2dvbWFnZV9kb3dubG9hZGFibGUva2V5L2NoZWNrJykpOw0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgdHJ1ZSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAna2V5PScgLiB1cmxlbmNvZGUoJGspIC4gJyZza3U9YWR2YW5jZWQtbmF2aWdhdGlvbiZkb21haW5zPScgLiB1cmxlbmNvZGUoaW1wbG9kZSgnLCcsICR0aGlzLT5nZXRBbGxTdG9yZURvbWFpbnMoKSkpIC4gJyZ2ZXI9JyAuIHVybGVuY29kZSgnNC45LjEnKSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7DQoNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllIT1NULCAwKTsNCg0KICAgICAgICAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOw0KDQogICAgICAgICRyID0gWmVuZF9Kc29uOjpkZWNvZGUoJGNvbnRlbnQpOw0KICAgICAgICAkZSA9IE1hZ2U6OmhlbHBlcignY29yZScpOw0KICAgICAgICBpZiAoZW1wdHkoJHIpKSB7DQoNCiAgICAgICAgICAgICR2YWx1ZTEgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL2FyJyk7DQoNCiAgICAgICAgICAgICRncm91cHMgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAnYWR2YW5jZWRuYXZpZ2F0aW9uJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJ2ZpZWxkcycgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAnYXInICAgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlMQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICd3ZWJzaXRlcycgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKU1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vd2Vic2l0ZXMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lJyAgICAgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKSRlLT5lbmNyeXB0KCR2YWx1ZTEgLiAodGltZSgpIC0gKDYwICogNjAgKiAyNCAqIDE1IC0gMTgwMCkpIC4gJHZhbHVlMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJGMgKyAxKQ0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgKTsNCg0KICAgICAgICAgICAgTWFnZTo6Z2V0TW9kZWwoJ2FkbWluaHRtbC9jb25maWdfZGF0YScpDQogICAgICAgICAgICAgICAgLT5zZXRTZWN0aW9uKCdnb21hZ2VfYWN0aXZhdGlvbicpDQogICAgICAgICAgICAgICAgLT5zZXRHcm91cHMoJGdyb3VwcykNCiAgICAgICAgICAgICAgICAtPnNhdmUoKTsNCg0KICAgICAgICAgICAgTWFnZTo6Z2V0Q29uZmlnKCktPnJlaW5pdCgpOw0KICAgICAgICAgICAgTWFnZTo6YXBwKCktPnJlaW5pdFN0b3JlcygpOw0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAkdmFsdWUxID0gJyc7DQogICAgICAgICR2YWx1ZTIgPSAnJzsNCg0KICAgICAgICBpZiAoaXNzZXQoJHJbJ2QnXSkgJiYgaXNzZXQoJHJbJ2MnXSkpIHsNCiAgICAgICAgICAgICR2YWx1ZTEgPSAkZS0+ZW5jcnlwdChiYXNlNjRfZW5jb2RlKFplbmRfSnNvbjo6ZW5jb2RlKCRyKSkpOw0KDQogICAgICAgICAgICBpZiAoISRzKSB7DQogICAgICAgICAgICAgICAgJHMgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vYWR2YW5jZWRuYXZpZ2F0aW9uL3dlYnNpdGVzJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRzICAgICAgPSBhcnJheV9zbGljZShleHBsb2RlKCcsJywgJHMpLCAwLCAkclsnYyddKTsNCiAgICAgICAgICAgICR2YWx1ZTIgPSAkZS0+ZW5jcnlwdCgkdmFsdWUxIC4gaW1wbG9kZSgnLCcsICRzKSAuICR2YWx1ZTEpOw0KICAgICAgICB9DQogICAgICAgICRncm91cHMgPSBhcnJheSgNCiAgICAgICAgICAgICdhZHZhbmNlZG5hdmlnYXRpb24nID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICdmaWVsZHMnID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnYXInICAgICAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlMQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnd2Vic2l0ZXMnICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gKHN0cmluZykkdmFsdWUyDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICd0aW1lJyAgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKSRlLT5lbmNyeXB0KCR2YWx1ZTEgLiB0aW1lKCkgLiAkdmFsdWUxKQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnaW5zdGFsbGVkJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gMQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnY291bnQnICAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gMCkNCg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICkNCiAgICAgICAgKTsNCg0KICAgICAgICBNYWdlOjpnZXRNb2RlbCgnYWRtaW5odG1sL2NvbmZpZ19kYXRhJykNCiAgICAgICAgICAgIC0+c2V0U2VjdGlvbignZ29tYWdlX2FjdGl2YXRpb24nKQ0KICAgICAgICAgICAgLT5zZXRHcm91cHMoJGdyb3VwcykNCiAgICAgICAgICAgIC0+c2F2ZSgpOw0KDQogICAgICAgIE1hZ2U6OmdldENvbmZpZygpLT5yZWluaXQoKTsNCiAgICAgICAgTWFnZTo6YXBwKCktPnJlaW5pdFN0b3JlcygpOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQHJldHVybiBhcnJheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnYSgpDQogICAgew0KICAgICAgICAkZ2FSZXN1bHQgPSBbXTsNCiAgICAgICAgJGRlY3J5cHRlZCA9IE1hZ2U6OmhlbHBlcignY29yZScpLT5kZWNyeXB0KE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9hZHZhbmNlZG5hdmlnYXRpb24vYXInKSk7DQogICAgICAgICRkZWNvZGVkQmFzZTY0ID0gYmFzZTY0X2RlY29kZSgkZGVjcnlwdGVkKTsNCg0KICAgICAgICBpZiAoJGRlY29kZWRCYXNlNjQpIHsNCiAgICAgICAgICAgICRnYVJlc3VsdCA9IFplbmRfSnNvbjo6ZGVjb2RlKCRkZWNvZGVkQmFzZTY0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkZ2FSZXN1bHQ7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzR29tYWdlTmF2aWdhdGlvbigpDQogICAgew0KICAgICAgICBpZiAoJHRoaXMtPmlzTW9iaWxlRGV2aWNlKCkgJiYgTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9nZW5lcmFsL2Rpc2FibGVfbW9iaWxlJykpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaW5fYXJyYXkoTWFnZTo6YXBwKCktPmdldFN0b3JlKCktPmdldFdlYnNpdGVJZCgpLCAkdGhpcy0+Z2V0QXZhaWxhdmVsV2Vic2l0ZXMoKSkgJiYNCiAgICAgICAgTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9nZW5lcmFsL21vZGUnKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNHb21hZ2VOYXZpZ2F0aW9uTWVudSgpDQogICAgew0KICAgICAgICByZXR1cm4gaW5fYXJyYXkoTWFnZTo6YXBwKCktPmdldFN0b3JlKCktPmdldFdlYnNpdGVJZCgpLCAkdGhpcy0+Z2V0QXZhaWxhdmVsV2Vic2l0ZXMoKSkgJiYNCiAgICAgICAgTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9tZW51YmFyc2V0dGluZ3MvbmF2aWdhdGlvbicpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0dvbWFnZU5hdmlnYXRpb25BamF4KCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+aXNHb21hZ2VOYXZpZ2F0aW9uKCkgJiYNCiAgICAgICAgTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9nZW5lcmFsL3BhZ2VyJykgJiYNCiAgICAgICAgKE1hZ2U6OnJlZ2lzdHJ5KCdjdXJyZW50X2NhdGVnb3J5JykgfHwNCiAgICAgICAgICAgIChNYWdlOjphcHAoKS0+Z2V0RnJvbnRDb250cm9sbGVyKCktPmdldFJlcXVlc3QoKS0+Z2V0Um91dGVOYW1lKCkgPT0gJ2NhdGFsb2dzZWFyY2gnICYmDQogICAgICAgICAgICAgICAgTWFnZTo6YXBwKCktPmdldEZyb250Q29udHJvbGxlcigpLT5nZXRSZXF1ZXN0KCktPmdldENvbnRyb2xsZXJOYW1lKCkgIT0gJ2FkdmFuY2VkJykpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0dvbWFnZU5hdmlnYXRpb25DbGVhckFqYXgoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5pc0dvbWFnZU5hdmlnYXRpb24oKSAmJg0KICAgICAgICAoTWFnZTo6cmVnaXN0cnkoJ2N1cnJlbnRfY2F0ZWdvcnknKSB8fA0KICAgICAgICAgICAgKE1hZ2U6OmFwcCgpLT5nZXRGcm9udENvbnRyb2xsZXIoKS0+Z2V0UmVxdWVzdCgpLT5nZXRSb3V0ZU5hbWUoKSA9PSAnY2F0YWxvZ3NlYXJjaCcgJiYNCiAgICAgICAgICAgICAgICBNYWdlOjphcHAoKS0+Z2V0RnJvbnRDb250cm9sbGVyKCktPmdldFJlcXVlc3QoKS0+Z2V0Q29udHJvbGxlck5hbWUoKSAhPSAnYWR2YW5jZWQnKSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGZvcm1hdENvbG9yKCR2YWx1ZSkNCiAgICB7DQogICAgICAgIGlmICgkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJy9bXmEtekEtWjAtOVxzXS8nLCAnJywgJHZhbHVlKSkgew0KICAgICAgICAgICAgJHZhbHVlID0gJyMnIC4gJHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkdmFsdWU7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzRnJlbmRseVVybCgpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmlzR29tYWdlTmF2aWdhdGlvbigpICYmDQogICAgICAgIE1hZ2U6OmdldFN0b3JlQ29uZmlnRmxhZygnZ29tYWdlX25hdmlnYXRpb24vZmlsdGVyX3NldHRpbmdzL2ZyZW5kbHl1cmwnKSAmJg0KICAgICAgICAhJHRoaXMtPmlzR29NYWdlU2VvQm9vc3RlckVuYWJsZWQoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNHb01hZ2VTZW9Cb29zdGVyRW5hYmxlZCgpDQogICAgew0KICAgICAgICAkX21vZHVsZXMgICAgICA9IE1hZ2U6OmdldENvbmZpZygpLT5nZXROb2RlKCdtb2R1bGVzJyktPmNoaWxkcmVuKCk7DQogICAgICAgICRfbW9kdWxlc0FycmF5ID0gKGFycmF5KSRfbW9kdWxlczsNCiAgICAgICAgaWYgKCFpc3NldCgkX21vZHVsZXNBcnJheVsnR29NYWdlX1Nlb0Jvb3N0ZXInXSkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJF9tb2R1bGVzQXJyYXlbJ0dvTWFnZV9TZW9Cb29zdGVyJ10tPmlzKCdhY3RpdmUnKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmVxdWVzdCgpDQogICAgew0KICAgICAgICAkcmVxdWVzdCA9IE1hZ2U6OmFwcCgpLT5nZXRGcm9udENvbnRyb2xsZXIoKS0+Z2V0UmVxdWVzdCgpOw0KICAgICAgICBpZiAoJHRoaXMtPmlzR29NYWdlU2VvQm9vc3RlckVuYWJsZWQoKSkgew0KICAgICAgICAgICAgJGhlbHBlciAgPSBNYWdlOjpoZWxwZXIoJ2dvbWFnZV9zZW9ib29zdGVyL2xheWVyZWQnKTsNCiAgICAgICAgICAgICRyZXF1ZXN0ID0gJGhlbHBlci0+Z2V0U2VwYXJhdG9yKCkgfHwgJGhlbHBlci0+Y2FuQWRkUmV3cml0ZVBhdGgoKSA/ICRoZWxwZXItPmdldFJlcXVlc3QoKSA6ICRyZXF1ZXN0Ow0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRyZXF1ZXN0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRGaWx0ZXJVcmwoJHJvdXRlID0gJyovKi8qJywgJHBhcmFtcyA9IGFycmF5KCkpDQogICAgew0KICAgICAgICBpZiAoISR0aGlzLT5pc0ZyZW5kbHlVcmwoKSkgew0KICAgICAgICAgICAgJHBhcmFtc1snX3F1ZXJ5J11bJ2FqYXgnXSA9IG51bGw7DQogICAgICAgICAgICANCgkJCXJldHVybiBNYWdlOjpoZWxwZXIoJ2dvbWFnZV9uYXZpZ2F0aW9uL3VybCcpLT53cmFwcChNYWdlOjpnZXRVcmwoJHJvdXRlLCAkcGFyYW1zKSk7DQogICAgICAgIH0NCg0KICAgICAgICAkbW9kZWwgPSBNYWdlOjpnZXRNb2RlbCgnY29yZS91cmwnKTsNCiAgICAgICAgJGF0dHIgID0gTWFnZTo6cmVnaXN0cnkoJ2dhbl9maWx0ZXJfYXR0cmlidXRlcycpOw0KDQogICAgICAgICRxdWVyeV9wYXJhbXMgPSBpc19hcnJheSgkbW9kZWwtPmdldFJlcXVlc3QoKS0+Z2V0UXVlcnkoKSkgPyAkbW9kZWwtPmdldFJlcXVlc3QoKS0+Z2V0UXVlcnkoKSA6IGFycmF5KCk7DQogICAgICAgICRxdWVyeSAgICAgICAgPSBhcnJheSgpOw0KDQogICAgICAgIGlmIChpc3NldCgkcGFyYW1zWydfcXVlcnknXSkgJiYgaXNfYXJyYXkoJHBhcmFtc1snX3F1ZXJ5J10pKSB7DQogICAgICAgICAgICAkcXVlcnlfcGFyYW1zID0gYXJyYXlfbWVyZ2UoJHF1ZXJ5X3BhcmFtcywgJHBhcmFtc1snX3F1ZXJ5J10pOw0KICAgICAgICB9DQoJCQ0KICAgICAgICBmb3JlYWNoICgkcXVlcnlfcGFyYW1zIGFzICRwYXJhbSA9PiAkdmFsdWUpIHsNCg0KICAgICAgICAgICAgaWYgKGlzX251bGwoJHZhbHVlKSkgew0KICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gbnVsbDsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCRwYXJhbSA9PSAnY2F0Jykgew0KICAgICAgICAgICAgICAgICR2YWx1ZXMgICAgICAgICA9IGV4cGxvZGUoJywnLCAkdmFsdWUpOw0KICAgICAgICAgICAgICAgICRwcmVwYXJlX3ZhbHVlcyA9IGFycmF5KCk7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHZhbHVlcyBhcyAkX3ZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgICRjYXRlZ29yeSA9IE1hZ2U6OmdldE1vZGVsKCdjYXRhbG9nL2NhdGVnb3J5JyktPmxvYWQoJF92YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkY2F0ZWdvcnkgJiYgJGNhdGVnb3J5LT5nZXRJZCgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWFnZTo6Z2V0U3RvcmVDb25maWdGbGFnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXJfc2V0dGluZ3MvZXhwZW5kX2ZyZW5kbHl1cmwnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXJlbnRfaWRzICAgICAgID0gJGNhdGVnb3J5LT5nZXRQYXJlbnRJZHMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFyZW50X2NhdGVnb3J5ICA9IE1hZ2U6OmdldE1vZGVsKCdjYXRhbG9nL2NhdGVnb3J5JyktPmxvYWQoZW5kKCRwYXJlbnRfaWRzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXBhcmVfdmFsdWVzW10gPSAkcGFyZW50X2NhdGVnb3J5LT5nZXREYXRhKCd1cmxfa2V5JykgLiAnfCcgLiAkY2F0ZWdvcnktPmdldERhdGEoJ3VybF9rZXknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXBhcmVfdmFsdWVzW10gPSAkY2F0ZWdvcnktPmdldERhdGEoJ3VybF9rZXknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwcmVwYXJlX3ZhbHVlcykpIHsNCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbV0gPSBpbXBsb2RlKCcsJywgJHByZXBhcmVfdmFsdWVzKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtXSA9IG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRhdHRyWyRwYXJhbV0pICYmICFpbl9hcnJheSgkYXR0clskcGFyYW1dWyd0eXBlJ10sIGFycmF5KCdwcmljZScsICdkZWNpbWFsJykpKSB7DQogICAgICAgICAgICAgICAgJHZhbHVlcyAgICAgICAgID0gZXhwbG9kZSgnLCcsICR2YWx1ZSk7DQogICAgICAgICAgICAgICAgJHByZXBhcmVfdmFsdWVzID0gYXJyYXkoKTsNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdmFsdWVzIGFzICRfdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGF0dHJbJHBhcmFtXVsnb3B0aW9ucyddIGFzICRfayA9PiAkX3YpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX3YgPT0gJF92YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcmVwYXJlX3ZhbHVlc1tdID0gJF9rOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHByZXBhcmVfdmFsdWVzKSkgew0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtXSA9IGltcGxvZGUoJywnLCAkcHJlcGFyZV92YWx1ZXMpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJGF0dHJbJHBhcmFtXSkgJiYgaW5fYXJyYXkoJGF0dHJbJHBhcmFtXVsndHlwZSddLCBhcnJheSgncHJpY2UnLCAnZGVjaW1hbCcpKSkgew0KICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdmFsdWVbJ2Zyb20nXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW0gLiAnX2Zyb20nXSA9ICR2YWx1ZVsnZnJvbSddOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdmFsdWVbJ3RvJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtIC4gJ190byddID0gJHZhbHVlWyd0byddOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCgkYXR0cmlidXRlID0gJHRoaXMtPmdldFByb2R1Y3RBdHRyaWJ1dGUoJHBhcmFtKSkgJiYNCiAgICAgICAgICAgICAgICAgICAgaW5fYXJyYXkoJGF0dHJpYnV0ZS0+Z2V0UmFuZ2VPcHRpb25zKCksIGFycmF5KEdvTWFnZV9OYXZpZ2F0aW9uX01vZGVsX0FkbWluaHRtbF9TeXN0ZW1fQ29uZmlnX1NvdXJjZV9GaWx0ZXJfT3B0aW9uc3JhbmdlOjpNQU5VQUxMWSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHb01hZ2VfTmF2aWdhdGlvbl9Nb2RlbF9BZG1pbmh0bWxfU3lzdGVtX0NvbmZpZ19Tb3VyY2VfRmlsdGVyX09wdGlvbnNyYW5nZTo6QVVUTykNCiAgICAgICAgICAgICAgICAgICAgKSAmJg0KICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlLT5nZXRGaWx0ZXJUeXBlKCkgPT0gR29NYWdlX05hdmlnYXRpb25fTW9kZWxfQ2F0YWxvZ19MYXllcjo6RklMVEVSX1RZUEVfREVGQVVMVA0KICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICAkdmFsdWVzICAgICAgICAgICAgICAgICAgPSBleHBsb2RlKCcsJywgJHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbSAuICdfZnJvbSddID0gJHZhbHVlc1swXTsNCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbSAuICdfdG8nXSAgID0gJHZhbHVlc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5WyRwYXJhbV0gICAgICAgICAgID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcXVlcnlbJHBhcmFtXSA9ICR2YWx1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRxdWVyeVskcGFyYW1dID0gJHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJHBhcmFtc1snX3F1ZXJ5J10gICAgICAgICA9ICRxdWVyeTsNCiAgICAgICAgJHBhcmFtc1snX3F1ZXJ5J11bJ2FqYXgnXSA9IG51bGw7DQoNCiAgICAgICAgcmV0dXJuIE1hZ2U6OmhlbHBlcignZ29tYWdlX25hdmlnYXRpb24vdXJsJyktPndyYXBwKCRtb2RlbC0+Z2V0VXJsKCRyb3V0ZSwgJHBhcmFtcykpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBmb3JtYXRVcmxWYWx1ZSgkdmFsdWUsICRkZWZhdWx0KQ0KICAgIHsNCiAgICAgICAgJG9sZExvY2FsZSAgPSBzZXRsb2NhbGUoTENfQ09MTEFURSwgIjAiKTsNCiAgICAgICAgJGxvY2FsZUNvZGUgPSBNYWdlOjphcHAoKS0+Z2V0TG9jYWxlKCktPmdldExvY2FsZUNvZGUoKTsNCiAgICAgICAgc2V0bG9jYWxlKExDX0NPTExBVEUsICRsb2NhbGVDb2RlIC4gJy5VVEY4JywgJ0MuVVRGLTgnLCAnZW5fVVMudXRmOCcpOw0KICAgICAgICAkdmFsdWUgPSBpY29udihtYl9kZXRlY3RfZW5jb2RpbmcoJHZhbHVlKSwgJ0FTQ0lJLy9UUkFOU0xJVCcsICR2YWx1ZSk7DQogICAgICAgIHNldGxvY2FsZShMQ19DT0xMQVRFLCAkb2xkTG9jYWxlKTsNCg0KICAgICAgICAkdmFsdWUgPSBzdHJ0b2xvd2VyKCR2YWx1ZSk7DQogICAgICAgICR2YWx1ZSA9IHByZWdfcmVwbGFjZSgnI1teMC05YS16XSsjaScsICctJywgTWFnZTo6aGVscGVyKCdjYXRhbG9nL3Byb2R1Y3RfdXJsJyktPmZvcm1hdCgkdmFsdWUpKTsNCiAgICAgICAgJHZhbHVlID0gdHJpbSgkdmFsdWUsICctJyk7DQoNCiAgICAgICAgcmV0dXJuICR2YWx1ZSA/ICR2YWx1ZSA6ICRkZWZhdWx0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc01vYmlsZURldmljZSgpDQogICAgew0KICAgICAgICAkZGV0ZWN0ID0gbmV3IE5hdmlnYXRpb25fTW9iaWxlX0RldGVjdCgpOw0KICAgICAgICByZXR1cm4gJGRldGVjdC0+aXNNb2JpbGUoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RmlsdGVySXRlbUNvdW50KCRmaWx0ZXIpDQogICAgew0KICAgICAgICAkY291bnQgPSAwOw0KICAgICAgICBpZiAoJGZpbHRlciAmJiAkZmlsdGVyLT5nZXRJdGVtcygpKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkZmlsdGVyLT5nZXRJdGVtcygpIGFzICRpdGVtKSB7DQogICAgICAgICAgICAgICAgJGNvdW50ICs9ICRpdGVtLT5nZXRDb3VudCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoJCQ0KICAgICAgICBpZiAoJGNvdW50ID09IDAgJiYgJGZpbHRlci0+Z2V0RmlsdGVyKCktPmdldFJlcXVlc3RWYXJWYWx1ZSgpID09ICdzdG9ja19zdGF0dXMnKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkY291bnQ7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEZpbHRlcigpDQogICAgew0KICAgICAgICAkZmlsdGVyID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2ZpbHRlci9maWx0ZXJfYnRuX3R4dCcpOw0KDQogICAgICAgIGlmICgkZmlsdGVyID09ICcnKSB7DQogICAgICAgICAgICAkZmlsdGVyID0gJHRoaXMtPl9fKCdGaWx0ZXInKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkZmlsdGVyOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDbGVhckFsbCgpDQogICAgew0KICAgICAgICAkY2xlYXIgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZmlsdGVyL2NsZWFyX2J0bl90eHQnKTsNCg0KICAgICAgICBpZiAoJGNsZWFyID09ICcnKSB7DQogICAgICAgICAgICAkY2xlYXIgPSAkdGhpcy0+X18oJ0NsZWFyIEFsbCcpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRjbGVhcjsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TW9yZSgpDQogICAgew0KICAgICAgICAkbW9yZSA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXIvbW9yZV9idG5fdHh0Jyk7DQoNCiAgICAgICAgaWYgKCRtb3JlID09ICcnKSB7DQogICAgICAgICAgICAkbW9yZSA9ICR0aGlzLT5fXygnTW9yZScpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRtb3JlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMZXNzKCkNCiAgICB7DQogICAgICAgICRsZXNzID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9uYXZpZ2F0aW9uL2ZpbHRlci9sZXNzX2J0bl90eHQnKTsNCg0KICAgICAgICBpZiAoJGxlc3MgPT0gJycpIHsNCiAgICAgICAgICAgICRsZXNzID0gJHRoaXMtPl9fKCdMZXNzJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGxlc3M7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNob3dtb3JlKCkNCiAgICB7DQogICAgICAgICRzaG93bW9yZSA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXIvc2hvd21vcmVfYnRuX3R4dCcpOw0KDQogICAgICAgIGlmICgkc2hvd21vcmUgPT0gJycpIHsNCiAgICAgICAgICAgICRzaG93bW9yZSA9ICR0aGlzLT5fXygnU2hvdyBtb3JlIHByb2R1Y3RzJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJHNob3dtb3JlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCYWNrdG90b3AoKQ0KICAgIHsNCiAgICAgICAgJGJhY2t0b3RvcCA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfbmF2aWdhdGlvbi9maWx0ZXIvYmFja3RvdG9wX2J0bl90eHQnKTsNCg0KICAgICAgICBpZiAoJGJhY2t0b3RvcCA9PSAnJykgew0KICAgICAgICAgICAgJGJhY2t0b3RvcCA9ICR0aGlzLT5fXygnQmFjayB0byBUb3AnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkYmFja3RvdG9wOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0VudGVycHJpc2UoKQ0KICAgIHsNCiAgICAgICAgaWYgKE1hZ2U6OmdldENvbmZpZygpLT5nZXRNb2R1bGVDb25maWcoJ0VudGVycHJpc2VfRW50ZXJwcmlzZScpICYmIE1hZ2U6OmdldENvbmZpZygpLT5nZXRNb2R1bGVDb25maWcoJ0VudGVycHJpc2VfQWRtaW5Hd3MnKSAmJiBNYWdlOjpnZXRDb25maWcoKS0+Z2V0TW9kdWxlQ29uZmlnKCdFbnRlcnByaXNlX0NoZWNrb3V0JykgJiYgTWFnZTo6Z2V0Q29uZmlnKCktPmdldE1vZHVsZUNvbmZpZygnRW50ZXJwcmlzZV9DdXN0b21lcicpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2lkZSgkdHlwZSkNCiAgICB7DQogICAgICAgIHN3aXRjaCAoJHR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgR29NYWdlX05hdmlnYXRpb25fTW9kZWxfQWRtaW5odG1sX1N5c3RlbV9Db25maWdfU291cmNlX0ZpbHRlcl9BdHRyaWJ1dGVsb2NhdGlvbjo6TEVGVF9CTE9DSzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJ2xlZnQnOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIEdvTWFnZV9OYXZpZ2F0aW9uX01vZGVsX0FkbWluaHRtbF9TeXN0ZW1fQ29uZmlnX1NvdXJjZV9GaWx0ZXJfQXR0cmlidXRlbG9jYXRpb246OkNPTlRFTlQ6DQogICAgICAgICAgICAgICAgcmV0dXJuICdjb250ZW50JzsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBHb01hZ2VfTmF2aWdhdGlvbl9Nb2RlbF9BZG1pbmh0bWxfU3lzdGVtX0NvbmZpZ19Tb3VyY2VfRmlsdGVyX0F0dHJpYnV0ZWxvY2F0aW9uOjpSSUdIVF9CTE9DSzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJ3JpZ2h0JzsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXR1cm4gJ2xlZnQnOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIG5vdGlmeSgpDQogICAgew0KICAgICAgICAkZnJlcXVlbmN5ID0gaW50dmFsKE1hZ2U6OmFwcCgpLT5sb2FkQ2FjaGUoJ2dvbWFnZV9ub3RpZmljYXRpb25zX2ZyZXF1ZW5jeScpKTsNCiAgICAgICAgaWYgKCEkZnJlcXVlbmN5KSB7DQogICAgICAgICAgICAkZnJlcXVlbmN5ID0gMjQ7DQogICAgICAgIH0NCiAgICAgICAgJGxhc3RfdXBkYXRlID0gaW50dmFsKE1hZ2U6OmFwcCgpLT5sb2FkQ2FjaGUoJ2dvbWFnZV9ub3RpZmljYXRpb25zX2xhc3RfdXBkYXRlJykpOw0KDQogICAgICAgIGlmICgoJGZyZXF1ZW5jeSAqIDYwICogNjAgKyAkbGFzdF91cGRhdGUpID4gdGltZSgpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAkdGltZXN0YW1wID0gJGxhc3RfdXBkYXRlOw0KICAgICAgICBpZiAoISR0aW1lc3RhbXApIHsNCiAgICAgICAgICAgICR0aW1lc3RhbXAgPSB0aW1lKCk7DQogICAgICAgIH0NCg0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgJGNoID0gY3VybF9pbml0KCk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCBzcHJpbnRmKCdodHRwczovL3d3dy5nb21hZ2UuY29tL2luZGV4LnBocC9nb21hZ2Vfbm90aWZpY2F0aW9uL2luZGV4L2RhdGEnKSk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgdHJ1ZSk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywgJ3NrdT1hZHZhbmNlZC1uYXZpZ2F0aW9uJnRpbWVzdGFtcD0nIC4gJHRpbWVzdGFtcCAuICcmdmVyPScgLiB1cmxlbmNvZGUoJzQuOS4xJykpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1RJTUVPVVQsIDMwKTsNCiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7DQoNCiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgMCk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWUhPU1QsIDApOw0KDQogICAgICAgICAgICAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOw0KDQogICAgICAgICAgICAkcmVzdWx0ID0gWmVuZF9Kc29uOjpkZWNvZGUoJGNvbnRlbnQpOw0KDQogICAgICAgICAgICBpZiAoJHJlc3VsdCAmJiBpc3NldCgkcmVzdWx0WydmcmVxdWVuY3knXSkgJiYgKCRyZXN1bHRbJ2ZyZXF1ZW5jeSddICE9ICRmcmVxdWVuY3kpKSB7DQogICAgICAgICAgICAgICAgTWFnZTo6YXBwKCktPnNhdmVDYWNoZSgkcmVzdWx0WydmcmVxdWVuY3knXSwgJ2dvbWFnZV9ub3RpZmljYXRpb25zX2ZyZXF1ZW5jeScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJHJlc3VsdCAmJiBpc3NldCgkcmVzdWx0WydkYXRhJ10pKSB7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVzdWx0WydkYXRhJ10pKSB7DQogICAgICAgICAgICAgICAgICAgIE1hZ2U6OmdldE1vZGVsKCdhZG1pbm5vdGlmaWNhdGlvbi9pbmJveCcpLT5wYXJzZSgkcmVzdWx0WydkYXRhJ10pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7DQogICAgICAgIH0NCg0KICAgICAgICBNYWdlOjphcHAoKS0+c2F2ZUNhY2hlKHRpbWUoKSwgJ2dvbWFnZV9ub3RpZmljYXRpb25zX2xhc3RfdXBkYXRlJyk7DQoNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SXNBbnltb3JlVmVyc2lvbigkbWFqb3IsICRtaW5vciwgJHJldmlzaW9uID0gMCkNCiAgICB7DQogICAgICAgICR2ZXJzaW9uX2luZm8gPSBNYWdlOjpnZXRWZXJzaW9uKCk7DQogICAgICAgICR2ZXJzaW9uX2luZm8gPSBleHBsb2RlKCcuJywgJHZlcnNpb25faW5mbyk7DQoNCiAgICAgICAgaWYgKCR2ZXJzaW9uX2luZm9bMF0gPiAkbWFqb3IpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2VpZiAoJHZlcnNpb25faW5mb1swXSA9PSAkbWFqb3IpIHsNCiAgICAgICAgICAgIGlmICgkdmVyc2lvbl9pbmZvWzFdID4gJG1pbm9yKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9IGVsc2VpZiAoJHZlcnNpb25faW5mb1sxXSA9PSAkbWlub3IpIHsNCiAgICAgICAgICAgICAgICBpZiAoJHZlcnNpb25faW5mb1syXSA+PSAkcmV2aXNpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFByb2R1Y3RBdHRyaWJ1dGUoJGNvZGUpDQogICAgew0KICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5wcm9kdWN0X2F0dHJpYnV0ZXNbJGNvZGVdKSkgew0KICAgICAgICAgICAgJGF0dHJpYnV0ZU1vZGVsICAgICAgICAgICAgICAgICAgPSBNYWdlOjpnZXRNb2RlbCgnZWF2L2VudGl0eV9hdHRyaWJ1dGUnKS0+bG9hZEJ5Q29kZSgnY2F0YWxvZ19wcm9kdWN0JywgJGNvZGUpOw0KICAgICAgICAgICAgJGF0dHJpYnV0ZSAgICAgICAgICAgICAgICAgICAgICAgPSBNYWdlOjpnZXRNb2RlbCgnY2F0YWxvZy9yZXNvdXJjZV9lYXZfYXR0cmlidXRlJyktPmxvYWQoJGF0dHJpYnV0ZU1vZGVsLT5nZXRJZCgpKTsNCiAgICAgICAgICAgICR0aGlzLT5wcm9kdWN0X2F0dHJpYnV0ZXNbJGNvZGVdID0gJGF0dHJpYnV0ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHRoaXMtPnByb2R1Y3RfYXR0cmlidXRlc1skY29kZV07DQogICAgfQ0KDQp9DQoNCg=="));
